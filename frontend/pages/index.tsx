import { Navigation } from "@/frontend/components/Navigation";
import { useGameQuery } from "@/frontend/graphql/generated/types";
import type { NextPage } from "next";
import Head from "next/head";
import Image from "next/image";

const Home: NextPage = () => {
  return (
    <div>
      <Head>
        <title>clip-games</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <Navigation></Navigation>
        <div className="mx-8 my-4">
          <GamesGrid gameIds={GAME_IDS}></GamesGrid>
        </div>
      </main>
    </div>
  );
};

const GAME_IDS: string[] = [
  "5jVrnHPmsMV1qSflBdJS",
  "ou5Y8uSB6s6CgYWiCRpa",
  "pkCaQiaDa7NyRFYtwZ8U",
  "sR6klPwn2WF0YGaeykq1",
];

export default Home;

const GamesGrid: React.FC<{ gameIds: string[] }> = ({ gameIds }) => {
  return (
    <div className="flex flex-wrap gap-4">
      {gameIds.map((gameId) => (
        <GamePackage key={gameId} gameId={gameId} />
      ))}
    </div>
  );
};

export const GamePackage: React.FC<{ gameId: string }> = ({ gameId }) => {
  const { loading, error, data } = useGameQuery({
    variables: {
      gameId: gameId,
    },
  });
  if (loading) {
    return (
      <div className="flex justify-center">
        <div className="animate-spin h-10 w-10 border-4 border-blue-500 rounded-full border-t-transparent"></div>
      </div>
    );
  }
  if (
    error ||
    data === undefined ||
    data.game === undefined ||
    data.game === null
  ) {
    return (
      <>
        <p> Something Went Wrong!</p>
      </>
    );
  }
  return (
    <div>
      <div className="flex flex-col">
        <Image
          src={
            data.game.imageUrl
              ? `${data.game.imageUrl}`
              : "https://placeimg.com/320/400/any"
          }
          alt={`${data.game.title}`}
          width="320"
          height="400"
        ></Image>
        <span>{data.game.title}</span>
      </div>
    </div>
  );
};
